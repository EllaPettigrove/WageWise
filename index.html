<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WageWise</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    .container { max-width: 700px; margin: auto; background: white; padding: 25px; border-radius: 12px; }
    h1, h2 { text-align: center; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
    select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
    button { margin-top: 20px; padding: 12px; width: 100%; background: #2563eb; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
    button:hover { background: #1e4fc7; }
    .section { margin-top: 30px; }
    .result { background: #eef2ff; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: center; }
    .explanation { background: #f0f0f0; padding: 15px; border-radius: 10px; margin-top: 10px; font-size: 14px; }
    .day { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px; margin-top: 10px; }
    .day label { grid-column: 1 / -1; margin-top: 0; }
    .button-group { display: flex; gap: 10px; }
    .download-btn { background: #10b981; flex: 1; }
    .download-btn:hover { background: #059669; }
    .help-btn { background: #ef4444; flex: 1; }
    .help-btn:hover { background: #dc2626; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
    .modal-content { background-color: white; margin: 5% auto; padding: 30px; border-radius: 12px; width: 80%; max-width: 600px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .modal-title { font-size: 28px; font-weight: bold; color: #dc2626; margin-bottom: 15px; }
    .modal-text { font-size: 16px; line-height: 1.6; margin-bottom: 20px; }
    .close-modal { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
    .close-modal:hover { color: #000; }
    .modal-link { color: #2563eb; text-decoration: none; }
    .modal-link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <h1>WageWise</h1>

    <div class="section">
      <h2>Step 1: Award</h2>
      <label>Hospitality Industry Award - Level 2</label>
      <select id="award">
        <option value="hospitality2">Hospitality Award - Level 2</option>
      </select>
      <p>If you do not know your award, <a href="https://calculate.fairwork.gov.au/FindYourAward?gclsrc=aw.ds&gad_source=1&gad_campaignid=23240839110&gbraid=0AAAABCANRmGrsifOsJqbT7scWd_b0QvML&gclid=CjwKCAiA55rJBhByEiwAFkY1QO1ii-NYnxn93LQX4TQSviJ5BGDOLnl44eMY1SGIEsjcHLmfSWfpyBoCUrAQAvD_BwE" target="_blank">click here</a> to find it.</p>
    </div>

    <div class="section">
      <h2>Step 2: Enter Your Weekly Shifts</h2>
      <div id="shifts">
        <div class="day">
          <label>Monday</label>
          <select id="monStart"><option value="">Start time</option></select>
          <select id="monEnd"><option value="">End time</option></select>
          <select id="monBreakStart"><option value="">Break start</option></select>
          <select id="monBreakEnd"><option value="">Break end</option></select>
        </div>
        <div class="day">
          <label>Tuesday</label>
          <select id="tueStart"><option value="">Start time</option></select>
          <select id="tueEnd"><option value="">End time</option></select>
          <select id="tueBreakStart"><option value="">Break start</option></select>
          <select id="tueBreakEnd"><option value="">Break end</option></select>
        </div>
        <div class="day">
          <label>Wednesday</label>
          <select id="wedStart"><option value="">Start time</option></select>
          <select id="wedEnd"><option value="">End time</option></select>
          <select id="wedBreakStart"><option value="">Break start</option></select>
          <select id="wedBreakEnd"><option value="">Break end</option></select>
        </div>
        <div class="day">
          <label>Thursday</label>
          <select id="thuStart"><option value="">Start time</option></select>
          <select id="thuEnd"><option value="">End time</option></select>
          <select id="thuBreakStart"><option value="">Break start</option></select>
          <select id="thuBreakEnd"><option value="">Break end</option></select>
        </div>
        <div class="day">
          <label>Friday</label>
          <select id="friStart"><option value="">Start time</option></select>
          <select id="friEnd"><option value="">End time</option></select>
          <select id="friBreakStart"><option value="">Break start</option></select>
          <select id="friBreakEnd"><option value="">Break end</option></select>
        </div>
        <div class="day">
          <label>Saturday</label>
          <select id="satStart"><option value="">Start time</option></select>
          <select id="satEnd"><option value="">End time</option></select>
          <select id="satBreakStart"><option value="">Break start</option></select>
          <select id="satBreakEnd"><option value="">Break end</option></select>
        </div>
        <div class="day">
          <label>Sunday</label>
          <select id="sunStart"><option value="">Start time</option></select>
          <select id="sunEnd"><option value="">End time</option></select>
          <select id="sunBreakStart"><option value="">Break start</option></select>
          <select id="sunBreakEnd"><option value="">Break end</option></select>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Step 3: Calculate Your Pay</h2>
      <button onclick="calculatePay()">Submit</button>
      <div id="output" class="result" style="display:none"></div>
      <div id="explanation" class="explanation" style="display:none"></div>
      <div class="button-group" style="display:none" id="buttonGroup">
        <button id="downloadBtn" class="download-btn" onclick="downloadPayslip()">Download Payslip</button>
        <button id="helpBtn" class="help-btn" onclick="showUnderpaymentModal()">My pay does not look right</button>
      </div>
    </div>
    
  </div>

  <div id="underpaymentModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeUnderpaymentModal()">&times;</span>
      <div class="modal-title">Underpayment Claims</div>
      <div class="modal-text">
        <p>Wage theft is a serious crime and we are here to support you.</p>
        <p>For advice on what to do if you suspect you have been underpaid by your employer, please see the Fair Work Information Page <a href="https://www.fairwork.gov.au/workplace-problems/common-workplace-problems/my-pay-doesnt-seem-right" target="_blank" class="modal-link">here</a>.</p>
      </div>
    </div>
  </div>

  <script>
    let lastCalculationData = {};

    function populateTimeSelects() {
      const times = [];
      for (let i = 0; i < 24; i++) {
        for (let mins = 0; mins < 60; mins += 15) {
          const hour = i === 0 ? '12' : i < 12 ? i : i === 12 ? '12' : (i - 12);
          const period = i < 12 ? 'am' : 'pm';
          const minStr = mins === 0 ? '00' : mins;
          const label = hour + '.' + minStr + period;
          const value = i + (mins / 60);
          times.push({ label: label, value: value });
        }
      }

      const selects = document.querySelectorAll('select[id$="Start"], select[id$="End"], select[id$="BreakStart"], select[id$="BreakEnd"]');
      selects.forEach(select => {
        times.forEach(time => {
          const option = document.createElement('option');
          option.value = time.value;
          option.textContent = time.label;
          select.appendChild(option);
        });
      });
    }

    function calculateTax(income) {
      let tax = 0;
      if (income <= 18200) tax = 0;
      else if (income <= 45000) tax = (income - 18200) * 0.16;
      else if (income <= 135000) tax = 4288 + (income - 45000) * 0.30;
      else if (income <= 190000) tax = 31288 + (income - 135000) * 0.37;
      else tax = 51638 + (income - 190000) * 0.45;
      return tax;
    }

    function calculatePay() {
      const dayRates = {
        weekdayDay: 32.21,
        weekdayEvening: 32.21 + 2.81,
        weekdayNight: 32.21 + 4.22,
        saturday: 38.78
      };

      const dayIds = ['mon','tue','wed','thu','fri','sat','sun'];
      let totalGross = 0;
      let explanationText = '';
      let errors = [];

      dayIds.forEach(id => {
          const start = parseFloat(document.getElementById(id + 'Start').value);
          const end = parseFloat(document.getElementById(id + 'End').value);
          const bStart = parseFloat(document.getElementById(id + 'BreakStart').value);
          const bEnd = parseFloat(document.getElementById(id + 'BreakEnd').value);

          if (!isNaN(start) && !isNaN(end)) {
              let pay = 0;
              let dayRatesApplied = [];
              for (let hour = start; hour < end; hour += 1) {
                  let currentHour = hour % 24;
                  if (!isNaN(bStart) && !isNaN(bEnd) && currentHour >= bStart && currentHour < bEnd) continue;

                  let rate = 0;
                  if (id !== 'sat') {
                      if (currentHour >= 7 && currentHour < 19) rate = dayRates.weekdayDay;
                      else if (currentHour >= 19 && currentHour < 24) rate = dayRates.weekdayEvening;
                      else rate = dayRates.weekdayNight;
                  } else {
                      rate = dayRates.saturday;
                  }
                  pay += rate;
                  dayRatesApplied.push(rate.toFixed(2));
              }
              explanationText += `${id.toUpperCase()}: Hourly rates applied = [${dayRatesApplied.join(', ')}], Day total = $${pay.toFixed(2)}<br>`;
              totalGross += pay;
          }
      });

      const output = document.getElementById('output');
      const explanationDiv = document.getElementById('explanation');
      const buttonGroup = document.getElementById('buttonGroup');

      if (errors.length > 0) {
          output.style.display = 'block';
          output.innerHTML = '<strong>Errors:</strong><br>' + errors.join('<br>');
          explanationDiv.style.display = 'none';
          buttonGroup.style.display = 'none';
          return;
      }

      const annualGross = totalGross * 52;
      const annualTax = calculateTax(annualGross);
      const annualNet = annualGross - annualTax;
      const weeklyNet = annualNet / 52;

      lastCalculationData = {
        totalGross: totalGross,
        weeklyNet: weeklyNet,
        annualGross: annualGross,
        annualTax: annualTax,
        annualNet: annualNet
      };

      output.style.display = 'block';
      output.innerHTML = `<p><strong>Estimated Gross Pay:</strong> $${totalGross.toFixed(2)}</p>` +
                         `<p><strong>Estimated Net Pay (after Australian tax):</strong> $${weeklyNet.toFixed(2)}</p>`;

      explanationDiv.style.display = 'block';
      explanationDiv.innerHTML = `<strong>How the calculation was made:</strong><br>${explanationText}<br>` +
                                 `Annual gross income multiplied by 52, Australian tax applied, then divided by 52 for weekly net estimate.`;

      buttonGroup.style.display = 'flex';
    }

    function downloadPayslip() {
      const data = lastCalculationData;
      const today = new Date().toLocaleDateString();
      
      let csvContent = "PAYSLIP\n";
      csvContent += `Generated: ${today}\n\n`;
      csvContent += `Weekly Gross Pay,${data.totalGross.toFixed(2)}\n`;
      csvContent += `Weekly Net Pay,${data.weeklyNet.toFixed(2)}\n\n`;
      csvContent += `Annual Gross Income,${data.annualGross.toFixed(2)}\n`;
      csvContent += `Annual Tax,${data.annualTax.toFixed(2)}\n`;
      csvContent += `Annual Net Income,${data.annualNet.toFixed(2)}\n`;

      const element = document.createElement('a');
      element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent));
      element.setAttribute('download', `payslip_${today.replace(/\//g, '-')}.csv`);
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    }

    function showUnderpaymentModal() {
      document.getElementById('underpaymentModal').style.display = 'block';
    }

    function closeUnderpaymentModal() {
      document.getElementById('underpaymentModal').style.display = 'none';
    }

    window.onclick = function(event) {
      const modal = document.getElementById('underpaymentModal');
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }

    window.addEventListener('DOMContentLoaded', populateTimeSelects);
  </script>
</body>
</html>